@model Information_System.Models.DocInfoModel
@{
    ViewBag.Title = "CreateInfoDoc";
    Information_System.Models.AccessRightModel p = null;
    p = Session["permission"] as Information_System.Models.AccessRightModel;
    ViewData["Plant"] = Session["plantRemark"];
    ViewData["IssueName"] = Session["login_name"].ToString();
    Information_System.Models.DocInfoModel d = null;
    Information_System.Models.FilePatch fp = null;
    if (ViewData["requestInfo"] != null)
    {
        d = ViewData["requestInfo"] as Information_System.Models.DocInfoModel;
    }

    if (ViewData["fp"] != null)
    {
        fp = ViewData["fp"] as Information_System.Models.FilePatch;
    }
    string warnning = string.Empty;
    if (ViewData["warn"] != null)
    {
        warnning = ViewData["warn"].ToString();
    }

}
<style>
    .txt {
        border-radius: 24px;
    }

    .mtd-10 {
        margin-top: -10px;
    }

    .tcb {
        color: #1F618D;
        font-weight: 500;
    }
</style>

<div style="background-color: white; padding: 16px;" class="mt-2">

    @if (p.IS_ADMIN)
    {

        if (TempData["CreateSucess"] != null)
        {
            <div id="createRequestDoc" class="alert alert-success" role="alert">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>Success!  </strong>@TempData["CreateSucess"]
            </div>
        }

        if (d != null && d.STATUS_ALL == "APPROVED")
        {
            <div class="alert alert-success" role="alert">
                @*<button type="button" class="close" data-dismiss="alert">&times;</button>*@
                <strong>Success! </strong>This document has been approved
            </div>
        }

        if (d != null && d.STATUS_ALL == "REJECT")
        {
            <div class="alert alert-danger" role="alert">
                @*<button type="button" class="close" data-dismiss="alert">&times;</button>*@
                <strong>Reject! </strong>This document has been rejected
            </div>
        }

        if (d != null && d.STATUS_ALL == "REVISE")
        {
            <div class="alert alert-danger" role="alert">
                @*<button type="button" class="close" data-dismiss="alert">&times;</button>*@
                <strong>Revise! </strong>This document has been revise
            </div>
        }

        if (d != null && d.STATUS_ALL == "IN-PROGRESS")
        {
            <div class="alert alert-warning" role="alert">
                @*<button type="button" class="close" data-dismiss="alert">&times;</button>*@
                <strong>In-Progress! </strong>This document is pending approval
            </div>
        }

        if (d != null && (d.STATUS_ALL == "APPROVED" || d.STATUS_ALL == "REJECT" || d.STATUS_ALL == "IN-PROGRESS"))
        {
            <h2>View Information Document</h2>
        }
        else
        {
            <h2>Create Information Document</h2>
        }


        <form method="post" enctype="multipart/form-data">
            <hr />
            @if (d != null && (d.INFO_NO != ""))
            {
                <div class="form-group row">
                    <label for="txtPlant" class="col-sm-4 col-lg-2 col-form-label">Information No.</label>
                    <div class="col-sm-8 col-lg-10">
                        <input type="text" readonly class="form-control col-lg-4" id="txtInfoNo" name="INFO_NO" value="@d.INFO_NO" style="font-weight: bold;">
                    </div>
                </div>
            }

            <div class="form-group row mtd-10">
                <label for="txtPlant" class="col-sm-4 col-lg-2 col-form-label">Plant / Department</label>
                <div class="col-sm-8 col-lg-10">
                    <input type="text" readonly class="form-control col-lg-4" id="txtPlant" name="PLANT_DEP" value="@ViewData["Plant"]">
                </div>
            </div>
            <div class="form-group row mtd-10">
                <label for="txtIssueName" class="col-sm-4 col-lg-2 col-form-label">Issue Name</label>
                <div class="col-sm-8 col-lg-10">
                    <input type="text" readonly class="form-control col-lg-4" id="txtIssueName" name="ISSUE_NAME" value="@ViewData["IssueName"]">
                </div>
            </div>

            <div class="form-group row mtd-10">
                <label for="txtDocType" class="col-sm-4 col-lg-2 col-form-label">Document Type</label>
                <div class="row col-sm-8 col-lg-10">
                    @if (d != null)
                    {
                        <input class="form-control col-lg-4 ml-3" type="text" id="txtDocType" name="DOC_TYPE" placeholder="Enter Document Type" value="@d.DOC_TYPE">
                    }
                    else
                    {
                        <input class="form-control col-lg-4 ml-3" type="text" id="txtDocType" name="DOC_TYPE" placeholder="Enter Document Type" value="Information">
                    }

                    @*<label class="col-lg-2 checkbox-inline text-center" style="margin-top: 8px;"><input type="checkbox" value="Approved" id="APPROVED_FLAX" name="APPROVED_FLAX"> Approved</label>*@
                    <label class="col-lg-2 checkbox-inline text-center" style="margin-top: 8px;"><input type="checkbox" value="Acknowlage" id="ACKNOWLAGE_FLEX" name="ACKNOWLAGE_FLEX" onclick="isShowCCCList();"> Acknowlage</label>
                    <div class="form-group" style="width: 200px;">
                        <select class="form-control" id="txtCC" name="txtCC" onchange="getCCList()" style="display: none; margin-bottom: -12px;">
                            @foreach (var cclist in ViewData["CC_list"] as List<Information_System.Models.ApproveGroup>)
                            {
                                if (d != null && cclist.ID == d.CC_GRP)
                                {
                                    <option value="@cclist.ID" onclick="getAppList(@cclist.ID)" selected>@cclist.NAME</option>
                                }
                                else
                                {
                                    <option value="@cclist.ID">@cclist.NAME</option>
                                }
                            }
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-group row" style="margin-top: -12px;">
                <label for="txtDocumentFlow" class="col-sm-4 col-lg-2 col-form-label">Document flow</label>
                <div class="col-sm-8 col-lg-10">
                    <select class="form-control col-lg-4" id="txtDocumentFlow" name="txtDocumentFlow" onchange="getAppList()">
                        @foreach (var aplist in ViewData["app_list"] as List<Information_System.Models.ApproveGroup>)
                        {
                            if (d != null && aplist.ID == d.DOC_FLOW_ID)
                            {
                                <option value="@aplist.ID" onclick="getAppList(@aplist.ID)" selected>@aplist.NAME</option>
                            }
                            else
                            {
                                <option value="@aplist.ID" onclick="getAppList(@aplist.ID)">@aplist.NAME</option>
                            }
                        }
                    </select>
                </div>
            </div>

            <div class="form-group row mtd-10">
                <label for="txtDocumentSubject" class="col-sm-4 col-lg-2 col-form-label">Document subject</label>
                <div class="col-sm-8 col-lg-10">
                    @*@if (d != null)
                        {
                            <input type="text" class="form-control col-lg-4" id="txtDocumentSubject" name="txtDocumentSubject" value="@d.DOC_SUBJECT">
                        }
                        else
                        {
                            <input type="text" class="form-control col-lg-4" id="txtDocumentSubject" name="txtDocumentSubject" placeholder="Enter Document Subject">
                        }*@

                    <select class="form-control col-lg-4" id="txtDocumentSubject" name="opSubject">
                        @foreach (var sj in ViewData["subject"] as List<string>)
                        {
                            if (d != null && d.DOC_SUBJECT == sj)
                            {
                                <option value="@sj" selected>@sj</option>
                            }
                            else
                            {
                                <option value="@sj">@sj</option>
                            }
                        }
                    </select>

                </div>
            </div>
            <div class="form-group row mtd-10">
                <label for="txtResonExplain" class="col-sm-4 col-lg-2 col-form-label">Reson Explain</label>
                <div class="col-sm-8 col-lg-10">
                    @if (d != null)
                    {
                        <input type="text" class="form-control col-lg-4" id="txtResonExplain" name="txtResonExplain" value="@d.REASON_EXPLAIN">
                    }
                    else
                    {
                        <input type="text" class="form-control col-lg-4" id="txtResonExplain" name="txtResonExplain" placeholder="Enter Reson Explain">
                    }

                </div>
            </div>
            @if (d != null)
            {
                <div class="form-group row mtd-10">
                    <label for="txtDetailReference " class="col-sm-4 col-lg-2 col-form-label">Detail Reference </label>
                    <div class="col-sm-8 col-lg-10">
                        <input type="text" class="form-control col-lg-4" id="txtDetailReference" name="txtDetailReference" value="@d.DETAIL_REF">
                        @*else
                            {
                                <input type="text" class="form-control col-lg-4" id="txtDetailReference" name="txtDetailReference" readonly placeholder="Enter Detail Reference">
                            }*@
                    </div>
                </div>
            }

            <div class="form-group row mt-4">
                <div class="col-sm-2 col-lg-2">
                    <label for="txtDocumentDetail">Document Detail</label>
                </div>
                <div class="col-sm-8 col-lg-8">
                    @if (d != null && d.ID != null)
                    {
                        <textarea class="form-control" style="min-width: 100%" id="txtDocumentDetail" name="txtDocumentDetail" rows="3" placeholder="Enter Document Detail">@d.DOC_DETAIL</textarea>
                    }
                    else
                    {
                        <textarea class="form-control" style="min-width: 100%" id="txtDocumentDetail" name="txtDocumentDetail" rows="3" placeholder="Enter Document Detail"></textarea>
                    }

                </div>
            </div>

            <div class="form-group row mtd-10">
                <label for="txtEffective " class="col-sm-4 col-lg-2 col-form-label">Effective</label>
                <div class="col-sm-8 col-lg-10">
                    @if (d != null && d.ID != null)
                    {
                        <input type="text" class="form-control col-lg-4" id="txtEffective" name="txtEffective" placeholder="Enter Effective" value="@d.EFFECTIVE">
                    }
                    else
                    {
                        <input type="text" class="form-control col-lg-4" id="txtEffective" name="txtEffective" placeholder="Enter Effective">
                    }
                </div>
            </div>
            <div class="form-group row mtd-10">
                <label for="txtAddOrderNo" class="col-sm-4 col-lg-2 col-form-label">Add order no</label>
                <div class="col-sm-8 col-lg-10">
                    @if (d != null && d.ID != null)
                    {
                        <input type="text" class="form-control col-lg-4" id="txtAddOrderNo" name="txtAddOrderNo" placeholder="Enter Effective" value="@d.ADD_ORDER_NO">
                    }
                    else
                    {
                        <input type="text" class="form-control col-lg-4" id="txtAddOrderNo" name="txtAddOrderNo" placeholder="Enter Add order no">
                    }
                </div>
            </div>

            <div class="form-group row mtd-10">
                <label for="txtRelation" class="col-sm-4 col-lg-2 col-form-label">Relation system </label>
                <div class="col-sm-8 col-lg-10">
                    <select class="form-control col-lg-4" id="txtRelation" name="txtRelation" onchange="getRelation();">
                        @foreach (var list in ViewData["relation"] as List<Information_System.Models.Relation>)
                        {
                            if (d != null && list.ID == d.RELATION_ID)
                            {
                                <option value="@list.ID" selected>@list.NAME</option>
                            }
                            else
                            {
                                <option value="@list.ID">@list.NAME</option>
                            }
                        }
                    </select>
                    <label id="Relation"></label>
                </div>
            </div>
            <div class="form-group row mtd-10">
                <label for="txtRelation" class="col-sm-4 col-lg-2 col-form-label">Warning Date</label>
                <div class="col-sm-8 col-lg-10">
                    @if (warnning != "")
                    {
                        <input name="warnning" type="text" id="txt_warn" value="@warnning" disabled="disabled" />
                    }
                    else
                    {
                        <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
                        <script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>
                        <script type="text/javascript">
                            $(document).ready(function () {
                                $('#txt_warn').datepicker({
                                    format: 'dd/mmm/yyyy',
                                    //ignoreReadonly: true,
                                });
                            })
                        </script>
                        <input type="text" class="form-control" placeholder="dd-mmm-yyyy" id="txt_warn">


                        @*<script>
                $('.datepicker').datepicker({
                    format: 'dd-MMM-yyyy'
                });
            </script>
            <style type="text/css">
                .ui-datepicker {
                    background: #333;
                    border: 1px solid #555;
                    color: #EEE;
                }
            </style>*@
                    }


                </div>
            </div>
            <div class="form-group row mtd-10">
                <label for="filePicture" class="col-sm-4 col-lg-2 col-form-label">Picture reference</label>
                <div class="col-sm-8 col-lg-10">
                    @*<div style="float: left;">Detail #1:</div>*@
                    <div id="PIC_REF_1" class="mb-2">
                        Detail #1:
                        @if (d != null && fp.txt_PIC_REF_1 != null && fp.txt_PIC_REF_1 != "")
                        {
                            <a class="ml-3" target="_blank" href="~/Temp_File/@fp.txt_PIC_REF_1">@fp.txt_PIC_REF_1</a> <button id="btnPic1" type="button" class="btn btn-danger btn-sm" style="margin-left: 16px" onclick="deleteFile('@HttpUtility.JavaScriptStringEncode(fp.txt_PIC_REF_1)','PIC_REF_1');">X</button>
                        }
                        else
                        {
                            <input type="file" class="ml-5" name="_PIC_REF_1" id="_PIC_REF_1" accept="image/*" />
                        }
                    </div>

                    @*<div style="float: left;">Detail #2:</div>*@
                    <div id="PIC_REF_2" class="mb-2">
                        Detail #2:
                        @if (d != null && fp.txt_PIC_REF_2 != null && fp.txt_PIC_REF_2 != "")
                        {
                            <a class="ml-3" target="_blank" href="~/Temp_File/@fp.txt_PIC_REF_2">@fp.txt_PIC_REF_2</a> <button id="btnPic2" type="button" class="btn btn-danger btn-sm" style="margin-left: 16px" onclick="deleteFile('@HttpUtility.JavaScriptStringEncode(fp.txt_PIC_REF_2)','PIC_REF_2');">X</button>
                        }
                        else
                        {
                            <input type="file" class="ml-5" name="_PIC_REF_2" id="_PIC_REF_2" accept="image/*" />
                        }
                    </div>
                </div>
            </div>

            <div class="form-group row mtd-10">
                <label for="filePicture" class="col-sm-4 col-lg-2 col-form-label">Attacched document</label>
                <div class="col-sm-8 col-lg-10">
                    <div id="ATT_DOC_PURCHASE" class="mb-2">
                        Purchase request form:
                        @if (d != null && fp.txt_ATT_DOC_PURCHASE != null && fp.txt_ATT_DOC_PURCHASE != "")
                        {
                            <a class="ml-3" target="_blank" href="~/Temp_File/@fp.txt_ATT_DOC_PURCHASE">@fp.txt_ATT_DOC_PURCHASE</a> <button id="btnAtt1" type="button" class="btn btn-danger btn-sm" style="margin-left: 16px" onclick="deleteFile('@HttpUtility.JavaScriptStringEncode(fp.txt_ATT_DOC_PURCHASE)','ATT_DOC_PURCHASE');">X</button>
                        }
                        else
                        {
                            <input class="ml-5" type="file" name="_ATT_DOC_PURCHASE" id="_ATT_DOC_PURCHASE" />
                        }
                    </div>
                    <div id="ATT_DOC_REQUIRE" class="mb-2">
                        Important notice Document:
                        @if (d != null && fp.txt_ATT_DOC_IMPORTANT != null && fp.txt_ATT_DOC_IMPORTANT != "")
                        {
                            <a class="ml-3" target="_blank" href="~/Temp_File/@fp.txt_ATT_DOC_IMPORTANT">@fp.txt_ATT_DOC_IMPORTANT</a> <button id="btnAtt2" type="button" class="btn btn-danger btn-sm" style="margin-left: 16px" onclick="deleteFile('@HttpUtility.JavaScriptStringEncode(fp.txt_ATT_DOC_IMPORTANT)','ATT_DOC_IMPORTANT');">X</button>
                        }
                        else
                        {
                            <input class="ml-5" type="file" name="_ATT_DOC_IMPORTANT" id="_ATT_DOC_IMPORTANT" />
                        }
                    </div>
                    <div id="ATT_DOC_REQUIRE" class="mb-2">
                        Requirement document:
                        @if (d != null && fp.txt_ATT_DOC_REQUIRE != null && fp.txt_ATT_DOC_REQUIRE != "")
                        {
                            <a class="ml-3" target="_blank" href="~/Temp_File/@fp.txt_ATT_DOC_REQUIRE">@fp.txt_ATT_DOC_REQUIRE</a> <button id="btnAtt2" type="button" class="btn btn-danger btn-sm" style="margin-left: 16px" onclick="deleteFile('@HttpUtility.JavaScriptStringEncode(fp.txt_ATT_DOC_REQUIRE)','ATT_DOC_REQUIRE');">X</button>
                        }
                        else
                        {
                            <input class="ml-5" type="file" name="_ATT_DOC_REQUIRE" id="_ATT_DOC_REQUIRE" />
                        }
                    </div>

                    <div id="ATT_DOC_OTHER" class="mb-2">
                        Other: *จำกัดไม่เกิน 5 ไฟล์
                        @if (d != null && fp.txt_ATT_DOC_OTHER != null)
                        {
                            foreach (string item in fp.txt_ATT_DOC_OTHER)
                            {
                                if (item != null && item != "")
                                {
                                    <a class="ml-3 test" target="_blank" href="~/Temp_File/@item">@item</a> <button id="btnAtt3" type="button" class="btn btn-danger btn-sm test" style="margin-left: 16px" onclick="deleteFile('@HttpUtility.JavaScriptStringEncode(item)','ATT_DOC_OTHER');">X</button>
                                }
                                else
                                {
                                }

                            }
                            <input class="ml-5" type="file" name="_ATT_DOC_OTHER" id="_ATT_DOC_OTHER" multiple />
                        }
                        else
                        {
                        
                        <input class="ml-5" type="file" name="_ATT_DOC_OTHER" id="_ATT_DOC_OTHER" multiple />

                        }



                    </div>

                    <div class="row col-8" id="fileLink">

                        @if (Model != null)
                        {
                            foreach (var f in Model.ATT_DOC_OTHER)
                            {
                                <p class='row col-8'>
                                    <a href="@Url.Content("~/Temp_File/")@f" target="_blank">@f</a>
                                    @if (Model.STATUS != "APPROVED")
                                    {
                                        <button type="button" class="btn btn-danger btn-sm" style="margin-left: 16px"  onclick="deleteFile('@f');">X</button>
                                    }
                                </p>
                            }
                        }
                    </div>
                </div>
            </div>

            @if (ViewData["revDoc"] != null)
            {
                <div class="form-group row">
                    <label for="txtRelDoc" class="col-sm-4 col-lg-2 col-form-label">Related documents</label>
                    <div class="col-lg-7 ">
                        @foreach (var list in ViewData["revDoc"] as List<Information_System.Models.RevDoc>)
                        {
                            string parameter = @list.REQ_ID + "?info_id=" + @list.INFO_ID;
                            <p><a href="~/Create/CreateInfoDoc/@parameter" target="_blank">@list.INFO_NAME [@list.STATUS]</a></p>
                        }
                    </div>
                </div>
            }

            <div class="row justify-content-end mt-2 mb-4" style="margin: 8px;">
                <div class="mr-3 mt-1" id="err" style="display: none;"><small style="color: red;">Sorry! Please try again!</small></div>

                @if (d != null && d.STATUS_ALL == "IN-PROGRESS")
                {
                    <button type="button" class="btn btn-danger mr-2" id="reviseInfo" data-toggle="modal" data-target="#reviseModel">Revise and save Information</button>
                }

                @if (d != null && d.ID != null && (d.STATUS_ALL != "APPROVED" || d.STATUS_ALL != "IN-PROGRESS" || d.STATUS_ALL != "REJECT"))
                {
                    <button type="button" class="btn btn-danger mr-2" id="btnEdit" data-toggle="modal" data-target="#editModel">Edit and save Information</button>
                }

                @if (d == null || (d.STATUS_ALL == null || d.STATUS_ALL == ""))
                {
                    <button type="button" class="btn mr-2" id="btnTemp" style="background-color: #E67E22 ; color: white;" data-toggle="modal" data-target="#tempModel">Temporary and Sent E-mail</button>
                }

                @if (d != null && (d.STATUS_ALL == "TECH-APPROVE"))
                {
                    <button type="button" class="btn btn-success mr-2" id="btnSave" data-toggle="modal" data-target="#saveModel">Save and Sent E-mail</button>
                }

                <button type="button" class="btn btn-secondary mr-2" id="btnCancel" data-toggle="modal" data-target="#cancelModel">Cancel</button>
            </div>
        </form>
        }
 
    else
        {
            <p style="color: red;">You don't have access right.</p>
        }

</div>

<div style="background-color: white; padding: 16px;" class="mt-2">
    <div class="row">
        <div class="table-responsive col-lg-7" id="AppTable">
            <table class="tb-radius table table-hover table-striped">
                <thead style="background-color: #D6EAF8;">
                    <tr>
                        @*<th class="text-center">Oper No.</th>*@
                        <th class="text-center">Approved ID</th>
                        <th class="text-center">Approved Name</th>
                        <th class="text-center">Approved E-Mail</th>
                        @if (d != null && (d.STATUS_ALL == "IN-PROGRESS" || d.STATUS_ALL == "APPROVED" || d.STATUS_ALL == "REJECT" || d.STATUS_ALL == "REVISE"))
                        {
                            <th class="text-center">Approved Status</th>
                            <th class="text-center">Approved Command</th>
                            <th class="text-center">Approved Date</th>
                        }
                    </tr>
                </thead>
                <tbody class="table-body" id="Appbody">
                </tbody>
            </table>
        </div>
        <div class="table-responsive col-lg-5" id="CCTable" style="display:none;">
            <table class="tb-radius table table-hover table-striped">
                <thead style="background-color: #E8DAEF;">
                    <tr>
                        <th class="text-center">For Acknowlage only</th>
                        <th class="text-center">Acknowlage e-mail</th>
                    </tr>
                </thead>
                <tbody class="table-body" id="CCbody">
                    <tr>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

<div class="modal fade" id="saveModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Save and Send Email</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">Do you want to save and send email information?</div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveInformation();">Yes</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="tempModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Create</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">Do you want to create information?</div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="createInfo('Temporary');">Yes</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Edit</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">Do you want to edit information?</div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="createInfo('Edit');">Yes</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="reviseModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Revise information</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Do you want to revise information?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="createInfo('Revise');">Yes</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="cancelModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Cancel</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">Do you want to cancel information?</div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="cancelInfo();">Yes</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="loadingModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog" style="top: 30%;" role="document">
        <div>
            <div style="align-items: center;">
                <div class="loader-cycle" style="margin:0 auto;"></div>
                <h4 class="mt-3" style="color:#3498db; text-align:center; text-shadow: 1px 1px #000000;">In-Progress</h4>
            </div>
        </div>
    </div>
</div>

@if (ViewData["requestInfo"] != null)
{

<script>

       if ('@d.STATUS_ALL' == "APPROVED" || '@d.STATUS_ALL' == "REJECT" || '@d.STATUS_ALL' == "REVISE") {
           document.getElementById('btnEdit').style.display = "none";
           document.getElementById('btnCancel').style.display = "none";
           const btnPic1 = document.getElementById('btnPic1');
           const btnPic2 = document.getElementById('btnPic2');
           const btnAtt1 = document.getElementById('btnAtt1');
           const btnAtt2 = document.getElementById('btnAtt2');
           const btnAtt3 = document.getElementById('btnAtt3');
           if (btnAtt1 != null) { btnAtt1.style.display = "none";  }
           if (btnAtt2 != null) { btnAtt2.style.display = "none"; }
           if (btnAtt3 != null) { btnAtt3.style.display = "none"; }
           if (btnPic1 != null) { btnPic1.style.display = "none"; }
           if (btnPic2 != null) { btnPic2.style.display = "none"; }

           const _PIC_REF_1 = document.getElementById('_PIC_REF_1');
           const _PIC_REF_2 = document.getElementById('_PIC_REF_2');
           const _ATT_DOC_PURCHASE = document.getElementById('_ATT_DOC_PURCHASE');
           const _ATT_DOC_REQUIRE = document.getElementById('_ATT_DOC_REQUIRE');
           const _ATT_DOC_OTHER = document.getElementById('_ATT_DOC_OTHER');
           const _ATT_DOC_IMPORTANT = document.getElementById('_ATT_DOC_IMPORTANT');
           if (_PIC_REF_1 != null) { _PIC_REF_1.style.display = "none"; }
           if (_PIC_REF_2 != null) { _PIC_REF_2.style.display = "none"; }
           if (_ATT_DOC_PURCHASE != null) { _ATT_DOC_PURCHASE.style.display = "none"; }
           if (_ATT_DOC_REQUIRE != null) { _ATT_DOC_REQUIRE.style.display = "none"; }
           if (_ATT_DOC_OTHER != null) { _ATT_DOC_OTHER.style.display = "none"; }
           //document.getElementById('btnPic1').style.display = "none";
           //document.getElementById('btnPic2').style.display = "none";
           //document.getElementById('btnAtt1').style.display = "none";
           //document.getElementById('btnAtt2').style.display = "none";
           //document.getElementById('btnAtt3').style.display = "none";

           //Disabled
           document.getElementById("ACKNOWLAGE_FLEX").setAttribute('disabled', 'disabled');
           document.getElementById("txtDocumentFlow").setAttribute('disabled', 'disabled');
           document.getElementById("txtCC").setAttribute('disabled', 'disabled');
           document.getElementById("txtRelation").setAttribute('disabled', 'disabled');
           document.getElementById("txtDocType").setAttribute('disabled', 'disabled');
           document.getElementById("txtDocumentDetail").setAttribute('disabled', 'disabled');
           document.getElementById("txtEffective").setAttribute('disabled', 'disabled');
           document.getElementById("txtAddOrderNo").setAttribute('disabled', 'disabled');
       } else if ('@d.STATUS_ALL' == "IN-PROGRESS") {
           document.getElementById('btnEdit').style.display = "none";
           document.getElementById('btnCancel').style.display = "none";
       }

       //document.getElementById('txtDocumentSubject').readOnly = true;
  /*     document.getElementById('txtDocumentSubject').setAttribute('disabled', 'disabled');*/
       document.getElementById('txtResonExplain').readOnly = true;
       document.getElementById('txtDetailReference').readOnly = true;

       @*if ('@d.APPROVED_FLAX' == "True") {
           document.getElementById('APPROVED_FLAX').checked = "checked";
       }*@
       if ('@d.ACKNOWLAGE_FLEX' == "True") {
           document.getElementById('ACKNOWLAGE_FLEX').checked = "checked";
       }

        function deleteFile(patch, field) {
           @if(TempData["NEWID"] != null)
           {
               @:var id = '@TempData["NEWID"].ToString()';
           }
                else
                {
                 @:var id = '@d.ID';
                }

            var accept = "";
            if (field == "PIC_REF_1" || field == "PIC_REF_2") {
                accept = "accept='image/*'";
            }
            else {
                accept = "";
            }

            if (confirm("Do you want to delete an attachment?")) {
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", "@Url.Action("deleteOneFile", "create")" + "?patch=" + patch + "&id="+ id + "&field=" + field);
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState == 4 && xhr.status == 200) {
                            //$('#' + field).empty();
                            //var a = "<input type='file' class='ml-5' name='_" + field + "' id='_" + field + "'" + accept +" />"
                            //$('#' + field).append(a);

                            window.location.reload();
                        }
                    }
                    xhr.send();
             }
       }

       function saveInformation() {
           $('#loadingModel').modal('show');
           var data = new FormData();
           data.append('id', '@d.ID');
           $.ajax({
                    type: "post",
                    data: data,
                    contentType: false,
                    processData: false,
                    cache: false,
                    url: "@Url.Action("saveInformation", "create")",
                    success: function (data) {
                        if (data == "True") {
                            window.location.reload();
                            window.scrollTo(0, 0);
                        } else {
                            hideLoadingModal();
                            document.getElementById("err").style.display = "block";
                        }
                    }
                });

       }

       function cancelInfo() {
           window.location.reload();
           var data = new FormData();
           data.append('id', '@d.ID');
           $.ajax({
               type: "post",
               data: data,
               contentType: false,
               processData: false,
               cache: false,
               url: "@Url.Action("cancel", "create")",
               success: function (data) {
                   if (data == "True") {
                       window.location.reload();
                   } else {
                       document.getElementById("err").style.display = "block";
                   }
               }

           });

       }

</script>
}

<script>
       @*var data1 = {
           REQUEST_NO: '@d.IS_NO',
           DOC_TYPE: $('#txtDocType').val(),
           REASON_EXPLAIN: $('#txtResonExplain').val(),
           DOC_FLOW_ID: txtDocumentFlow.value,
           DOC_FLOW_TEXT: txtDocumentFlow.text,
           DETAIL_REF: $('#txtDetailReference').val(),
           DOC_DETAIL: $('#txtDocumentDetail').val(),
           EFFECTIVE: $('#txtEffective').val(),
           ADD_ORDER_NO: $('#txtAddOrderNo').val(),
           RELATION_ID: txtRelation.value,
           RELATION_TEXT: txtRelation.text,
           //PIC_REF_1: PIC_REF_1.files,
           //PIC_REF_2: PIC_REF_2.files,
           //ATT_DOC_PURCHASE: ATT_DOC_PURCHASE.files,
           //ATT_DOC_REQUIRE: ATT_DOC_REQUIRE.files,
           //ATT_DOC_OTHER: ATT_DOC_OTHER.files,
           action: action,
       } *@
    function isShowCCCList() {
        var chk = document.getElementById("ACKNOWLAGE_FLEX");
        var ccList = document.getElementById("txtCC");
        var CCTable = document.getElementById("CCTable");
        if (chk.checked) {
            ccList.style.display = "";
            CCTable.style.display = "";
        } else {
            ccList.style.display = "none";
            CCTable.style.display = "none";
        }
    }
    isShowCCCList();

    function createInfo(action) {
        $('#tempModel').modal('hide');
        $('#editModel').modal('hide');
        $('#loadingModel').modal('show');
        //var APPROVED_FLAX = 0;
        var ACKNOWLAGE_FLEX = 0;
        //if (document.getElementById('APPROVED_FLAX').checked) {
        //    APPROVED_FLAX = 1;
        //}
        if (document.getElementById('ACKNOWLAGE_FLEX').checked === true) {
            ACKNOWLAGE_FLEX = 1;
        }

        var PIC_REF_1 = $("#_PIC_REF_1").get(0);
        var PIC_REF_2 = $("#_PIC_REF_2").get(0);
        var ATT_DOC_PURCHASE = $("#_ATT_DOC_PURCHASE").get(0);
        var ATT_DOC_REQUIRE = $("#_ATT_DOC_REQUIRE").get(0);
        var fileUpload = $("#_ATT_DOC_OTHER").get(0);
       

        console.log(ATT_DOC_OTHER)
        var ATT_DOC_IMPORTANT = $("#_ATT_DOC_IMPORTANT").get(0);
        var txt_warn = $("#txt_warn").val();
        var txtRelation = document.getElementById("txtRelation");
        var txtDocumentFlow = document.getElementById("txtDocumentFlow");
        var txtCC = document.getElementById("txtCC");
        var data = new FormData();
        if (PIC_REF_1 != undefined) {
            data.append('PIC_REF_1', PIC_REF_1.files[0]);
        }
        if (PIC_REF_2 != undefined) {
            data.append('PIC_REF_2', PIC_REF_2.files[0]);
        }
        if (ATT_DOC_PURCHASE != undefined) {
            data.append('ATT_DOC_PURCHASE', ATT_DOC_PURCHASE.files[0]);
        }
        if (ATT_DOC_REQUIRE != undefined) {
            data.append('ATT_DOC_REQUIRE', ATT_DOC_REQUIRE.files[0]);
        }

        if (ATT_DOC_IMPORTANT != undefined) {
            data.append('ATT_DOC_IMPORTANT', ATT_DOC_IMPORTANT.files[0]);
        }
        var files = fileUpload.files;
        for (var i = 0; i < files.length; i++) {
            data.append('ATT_DOC_OTHER', files[i]);
        }
        //data.append('ATT_DOC_PURCHASE', ATT_DOC_PURCHASE.files[0]);
        ////data.append('ATT_DOC_REQUIRE', ATT_DOC_REQUIRE.files[0]);
        //data.append('ATT_DOC_OTHER', ATT_DOC_OTHER.files[0]);
        @if(d != null)
        {
            @Html.Raw("data.append('ID', '"+ d.ID + "');");
            @Html.Raw("data.append('REQUEST_NO', '"+ d.REQUEST_NO +"');");
        }
        data.append('DOC_TYPE',  $('#txtDocType').val());
        data.append('REASON_EXPLAIN', $('#txtResonExplain').val());
        data.append('DOC_FLOW_ID', txtDocumentFlow.value);
        if (ACKNOWLAGE_FLEX == 1) {
            data.append('CC_GRP', txtCC.value);
            alert(txtCC.value)
        }
        data.append('DOC_FLOW_TEXT', txtDocumentFlow.options[txtDocumentFlow.selectedIndex].innerText);
        data.append('DETAIL_REF', $('#txtDetailReference').val());
        data.append('DOC_DETAIL', $('#txtDocumentDetail').val());
        data.append('EFFECTIVE', $('#txtEffective').val());
        data.append('ADD_ORDER_NO', $('#txtAddOrderNo').val());
        data.append('RELATION_ID', txtRelation.value);
        data.append('RELATION_TEXT', txtRelation.options[txtRelation.selectedIndex].innerText);
        //data.append('APPROVED_FLAX', APPROVED_FLAX);
        data.append('ACKNOWLAGE_FLEX', ACKNOWLAGE_FLEX);
        data.append('PLANT_DEP', '@ViewData["Plant"]');
        data.append('APPROVE_LIST', Applist);
        data.append('WARNNIG_DATE', txt_warn);

        data.append('INFO_NO', $('#txtInfoNo').val());

        data.append('DOC_SUBJECT', $('#txtDocumentSubject').val());
        @if (d != null)
        {
            @Html.Raw(" if (txtDocumentFlow.value != '" + @d.DOC_FLOW_ID + "') { ");
            @Html.Raw("data.append('update_app_flow', 'Y'); }");

        }
        @*if ('@d' != null && txtDocumentFlow.value != '@d.DOC_FLOW_ID') {
            data.append('update_app_flow', 'Y');
        }*@
        data.append('action', action);

        //var textAction = "";
        //if (action == "Edit") {
        //    textAction = "edit";
        //} else {
        //    textAction = "create";
        //}
        $.ajax({
                    type: "post",
                    data: data,
                    contentType: false,
                    processData: false,
                    cache: false,
                    url: "@Url.Action("createInfoDoc", "create")",
                    success: function (data) {
                        if (data == "True") {
                            window.location.reload();
                        } else if (data == "False") {
                            hideLoadingModal();
                            document.getElementById("err").style.display = "block";
                        } else {
                            window.location.replace("@Url.Action("CreateInfoDoc", "Create")" + data)
                        }
                    }
         });
    }

    function hideLoadingModal() {
        $('#loadingModel').on('shown.bs.modal', function () {
            $('#loadingModel').modal('hide');
        });
    }


    var Applist = [];
    function getAppList() {
        const id = document.getElementById("txtDocumentFlow").value;
        var xhr = new XMLHttpRequest();
        var url;

        @if (d != null && (d.STATUS_ALL == "APPROVED" || d.STATUS_ALL == "REJECT" || d.STATUS_ALL == "REVISE")) {
            @Html.Raw(" url = '" + Url.Action("getApproveLists", "Create") + "?id=" + TempData["NEWID"].ToString() + "';");
            @Html.Raw(" document.getElementById('AppTable').className = 'table-responsive col-lg-10'; ");
        } else if (d != null && (d.STATUS_ALL == "IN-PROGRESS"))
        {
            @Html.Raw(" if ('"+@d.DOC_FLOW_ID+"' == id) { url = '" + Url.Action("getApproveLists", "Create") + "?id=" + TempData["NEWID"].ToString() + "'; } ");
            @Html.Raw(" else { url = '" + Url.Action("getMailGrp", "Create") + "?id=appID&issueID=" + d.REQUIREMENT_ISSUE_ID + "'; } ");
            @Html.Raw(" document.getElementById('AppTable').className = 'table-responsive col-lg-10'; ");

        } else if (d != null && (d.REQUIREMENT_ISSUE_ID != null || d.REQUIREMENT_ISSUE_ID != "")) {
            @Html.Raw(" url = '"+ Url.Action("getMailGrp", "Create")+ "?id=appID&issueID="+ d.REQUIREMENT_ISSUE_ID +"'");
        } else {
            @Html.Raw(" url = '"+ Url.Action("getMailGrp", "Create")+ "?id=appID'");
        }

        xhr.onreadystatechange = function () {
            if (xhr.readyState == XMLHttpRequest.DONE) {
                var list = JSON.parse(xhr.responseText);
                $('#Appbody').empty();
                Applist = [];
                for (var i = 0; i < list.length; i++) {
                    var date = "";
                    if (list[i].EMP_DATE != null) {
                        //date = new Date(parseInt(list[i].EMP_DATE.substr(6))).toLocaleDateString('th-TH');
                        date = formatDate(new Date(Math.floor(subDateStr(list[i].EMP_DATE))))
                    }
                    var html = "";
                    html += "<tr> <td>" + list[i].EMP_ID + "</td> <td>" + list[i].EMP_NAME + "</td> <td>" + list[i].EMP_EMAIL + "</td>";
                    @if (d != null && (d.STATUS_ALL == "IN-PROGRESS" || d.STATUS_ALL == "APPROVED" || d.STATUS_ALL == "REJECT" || d.STATUS_ALL == "REVISE"))
                     {
                        @Html.Raw(" html += '<td>' + list[i].EMP_STATUS + '</td><td>' + list[i].EMP_COMMENT + '</td><td>' + date + '</td>' ;");
                    }
                    html += "</tr>";
                    $('#Appbody').append(html);
                    Applist.push(list[i].EMP_ID);
                }
            }
        }

        url = url.replace("appID", id);
        xhr.open("GET", url , true);
        xhr.send(null);
    }
    getAppList();

    function formatDate(date) {
        d = ('0' + date.getDate()).slice(-2) + "-" + ('0' + (date.getMonth() + 1)).slice(-2) + "-" + date.getFullYear() + " " + ('0' + date.getHours()).slice(-2) + ":" + ('0' + date.getMinutes()).slice(-2);
        return d;
    }

    function subDateStr(Str) {
        var dateStr = Str.substring(
            Str.lastIndexOf("(") + 1,
            Str.lastIndexOf(")")
        );
        return dateStr;
    }

    function getCCList() {
        const id = document.getElementById("txtCC").value;
        var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == XMLHttpRequest.DONE) {
                        var list = JSON.parse(xhr.responseText);
                        $('#CCbody').empty();
                        for (var i = 0; i < list.length; i++) {
                            var html = "";
                            html += "<tr> <td>" + list[i].EMP_NAME + "</td> <td>" + list[i].EMP_EMAIL + "</td> </tr>"
                            $('#CCbody').append(html);
                        }
                    }
                }

                xhr.open("GET", "@Url.Action("getMailGrpCC", "Create")" + "?id=" + id, true);
                xhr.send(null);
    }
    getCCList();

    function getRelation() {
        var obj = @Html.Raw(Json.Encode(ViewData["relation"]));
        const id = document.getElementById("txtRelation").value;
        var x = obj.find(x => x.ID === id);
        document.getElementById("Relation").innerText = x.DETAIL;
    }
    getRelation();


    document.getElementById("_ATT_DOC_OTHER").onchange = function () {
        var fileUpload = $("#_ATT_DOC_OTHER").get(0);
        var files = fileUpload.files;
        var data = new FormData();
        for (var i = 0; i < files.length; i++) {
            data.append(files[i].name, files[i]);
        }
        @if(d != null)
        {
           @: data.append('id', '@d.ID');
        }
        $.ajax({
                type: "post",
                data: data,
                contentType: false,
                processData: false,
                url: "@Url.Action("UploadFile", "create")",
                success: function (data) {
                    $('#fileLink').empty();
                    $(".test").hide();
                    $('#fileUpload').val('');
                    var html = "";
                    for (var i = 0; i < data.length; i++) {
                        var a = "'"+data[i] +"'";
                        html += "<p class='row col-8'><a id='F" + i + "' href=" + "'@Url.Content("~/Temp_File/")" + escape(data[i]) + "'" + " target='_blank'>" + data[i] + "</a><button id='" + data[i] + "' onclick='deleteFile("+i+");' type='button' class='btn btn-danger btn-sm' style='margin-left: 16px'>X</button></p><br>";
                    }
                    $('#fileLink').append(html)
                    //$('#btnAtt3').each(
                    //    this.hide()
                    //)


                }
        });

    }

    function deleteFile(btnid) {
        @if (d != null) {
              @:var id = '@d.ID';
        }

        const f = document.getElementById("F" + btnid);
        if (f == null) {
            var patch = btnid
        } else {
            var patch = f.innerText;
        }

        if (confirm("Do you want to delete an attachment?")) {
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "@Url.Action("deleteFile", "create")" + "?patch=" + patch + "&id="+ id);
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        data = JSON.parse(xhr.responseText);
                        $('#fileLink').empty();
                        var html = "";
                        for (var i = 0; i < data.length; i++) {
                            var a = "'" + data[i] + "'";
                            html += "<p class='row col-8'><a id='F" + i + "' href=" + "'@Url.Content("~/Temp_File/")" + data[i] + "'" + " target='_blank'>" + data[i] + "</a><button id='" + data[i] + "' onclick='deleteFile(" + i + ");' type='button' class='btn btn-danger btn-sm' style='margin-left: 16px'>X</button></p><br>";
                        }
                          $('#fileLink').append(html)
                    }
                }
                xhr.send();
         }
    }

     document.getElementById("_ATT_DOC_OTHER").onchange = function () {
        var fileUpload = $("#_ATT_DOC_OTHER").get(0);
        var files = fileUpload.files;
        var data = new FormData();
        for (var i = 0; i < files.length; i++) {
            data.append(files[i].name, files[i]);
        }
        @if(d != null)
        {
           @: data.append('id', '@d.ID');
        }
        $.ajax({
                type: "post",
                data: data,
                contentType: false,
                processData: false,
                url: "@Url.Action("UploadFile_INFO", "create")",
                success: function (data) {
                    $('#fileLink').empty();
                    $(".test").hide();
                    $('#fileUpload').val('');
                    var html = "";
                    for (var i = 0; i < data.length; i++) {
                        var a = "'"+data[i] +"'";
                        html += "<p class='row col-8'><a id='F" + i + "' href=" + "'@Url.Content("~/Temp_File/")" + escape(data[i]) + "'" + " target='_blank'>" + data[i] + "</a><button id='" + data[i] + "' onclick='deleteFile("+i+");' type='button' class='btn btn-danger btn-sm' style='margin-left: 16px'>X</button></p><br>";
                    }
                    $('#fileLink').append(html)
                    //$('#btnAtt3').each(
                    //    this.hide()
                    //)


                }
        });

    }

</script>
